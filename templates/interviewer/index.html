{% extends "base.html" %}
{% block body %}
    <style>
        #wrapper {
            width: 800px;
            margin: 0 auto;
            margin-top: 20px;
        }

        #app {
            margin: 30px;
        }

        .el-step__head.is-finish, .el-step__title.is-finish, .el-step__description.is-finish {
            color: #009688;
            border-color: #009688;
        }

        .avatar {
            width: 328px;
            height: 178px;
            display: block;
        }

        .avatar-uploader .el-upload {
            border: 1px dashed #d9d9d9;
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .avatar-uploader .el-upload:hover {
            border-color: #409EFF;
        }

        .avatar-uploader-icon {
            font-size: 28px;
            color: #8c939d;
            width: 328px;
            height: 178px;
            line-height: 178px;
            text-align: center;
        }
    </style>
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend>申请成为面试官</legend>
    </fieldset>
    <div id="app">
        <el-steps :active="active">
            <el-step title="步骤 1" description="身份信息"></el-step>
            <el-step title="步骤 2" description="学历信息"></el-step>
            <el-step title="步骤 3" description="工作经历"></el-step>
            <el-step title="步骤 4" description="其他证明"></el-step>
            <el-step title="步骤 5" description="提交"></el-step>
            <el-step title="步骤 6" description="审核"></el-step>
        </el-steps>
        <div id="wrapper">
            <transition name="el-fade-in-linear">


                <el-form ref="form" :model="form" label-width="180px" v-if="active === 0">
                    <el-form-item label="昵称:">
                        <el-input v-model="form.name"></el-input>
                    </el-form-item>
                    <el-form-item label="手机号:">
                        <el-input v-model="form.phone"></el-input>
                        <el-button @click="send_code()" style="margin-top: 10px;">获取验证码</el-button>
                    </el-form-item>
                    <el-form-item label="验证码:">
                        <el-input v-model="form.code"></el-input>
                    </el-form-item>
                    <el-form-item label="身份证(正面):">
                        <el-upload
                                v-loading="loading"
                                element-loading-text="拼命识别中"
                                element-loading-spinner="el-icon-loading"
                                class="avatar-uploader"
                                :action="upload_url"
                                :show-file-list="false"
                                :on-success="handleAvatarSuccess"
                                :before-upload="beforeAvatarUpload">
                            <img v-if="imageUrl1" :src="imageUrl1" class="avatar">
                            <i v-else class="el-icon-plus avatar-uploader-icon"></i>
                        </el-upload>
                    </el-form-item>
                    <div v-if="imageUrl1">
                        <el-form-item label="姓名:">
                            <el-input v-model="form.ocr_info_front.name"></el-input>
                        </el-form-item>
                        <el-form-item label="性别:">
                            <el-input v-model="form.ocr_info_front.sex"></el-input>
                        </el-form-item>
                        <el-form-item label="出生年月:">
                            <el-input v-model="form.ocr_info_front.birthday"></el-input>
                        </el-form-item>
                        <el-form-item label="民族:">
                            <el-input v-model="form.ocr_info_front.nation"></el-input>
                        </el-form-item>
                        <el-form-item label="住址:">
                            <el-input v-model="form.ocr_info_front.address"></el-input>
                        </el-form-item>
                        <el-form-item label="身份号码:">
                            <el-input v-model="form.ocr_info_front.number_id"></el-input>
                        </el-form-item>
                    </div>
                    <el-form-item label="身份证(反面):">
                        <el-upload
                                v-loading="loading2"
                                element-loading-text="拼命识别中"
                                element-loading-spinner="el-icon-loading"
                                class="avatar-uploader"
                                :action="upload_url"
                                :show-file-list="false"
                                :on-success="handleAvatarSuccess2"
                                :before-upload="beforeAvatarUpload">
                            <img v-if="imageUrl2" :src="imageUrl2" class="avatar">
                            <i v-else class="el-icon-plus avatar-uploader-icon"></i>
                        </el-upload>
                    </el-form-item>
                    <div v-if="imageUrl2">
                        <el-form-item label="签发日期:">
                            <el-input v-model="form.ocr_info_back.start_time"></el-input>
                        </el-form-item>
                        <el-form-item label="失效日期:">
                            <el-input v-model="form.ocr_info_back.end_time"></el-input>
                        </el-form-item>
                        <el-form-item label="签发机关:">
                            <el-input v-model="form.ocr_info_back.organ"></el-input>
                        </el-form-item>
                    </div>
                    <el-form-item>
                        <el-button type="primary" @click="next(1)" v-if="active < 5">下一步</el-button>
                        <el-button type="primary" @click="next(-1)" v-if="active > 1 && active <= 5">上一步</el-button>
                        <el-button type="primary" @click="next(1)" v-if="active == 5">提交审核</el-button>
                    </el-form-item>
                </el-form>
            </transition>
            <transition name="el-fade-in-linear">
                <el-form ref="form" :model="form" label-width="80px" v-if="active === 1">
                    <el-form-item label="昵称">
                        <el-input v-model="form.name"></el-input>
                    </el-form-item>
                    <el-form-item label="手机号">
                        <el-input v-model="form.name"></el-input>
                    </el-form-item>
                    <el-form-item label="验证码">
                        <el-input v-model="form.name"></el-input>
                    </el-form-item>
                    <el-form-item>
                        <el-button type="primary" @click="next(1)" v-if="active < 5">下一步</el-button>
                        <el-button type="primary" @click="next(-1)" v-if="active > 0 && active <= 5">上一步</el-button>
                        <el-button type="primary" @click="next(1)" v-if="active == 5">提交审核</el-button>
                    </el-form-item>
                </el-form>
            </transition>
        </div>
    </div>
{% endblock %}
{% block js %}
    <script>

        var number_id_img1 = "";
        var number_id_img2 = "";
        var vue = new Vue({
            el: "#app",
            data: {
                loading: false,
                loading2: false,
                active: 0,
                form: {
                    ocr_info_front: {},
                    ocr_info_back: {}
                },
                ocr_info_front: {},
                ocr_info_back: {},
                imageUrl1: '',
                imageUrl2: '',
                upload_url: "{{ upload_url|safe }}",
                web_file_url: "{{ web_file_url|safe }}",
                exit_count: 60,

            },
            created() {


            },
            methods: {

                send_code() {
                    msg_ok("验证码已发送，2分钟内有效。")
                    var inter_exit = window.setInterval(function () {
                        this.exit_count--;
                        if (this.exit_count < 0) {
                            window.clearInterval(inter_exit);
                        } else {
                            $("#send_code").text(exit_count + 's')
                        }
                    }, 1000);
                },
                next(num) {
                    if (num === 1) {
                        if (this.active !== 6) {
                            this.active++
                        }
                    } else {
                        this.active--
                    }
                },
                handleAvatarSuccess(res, file) {
                    console.log(res.data[0].file_url)
                    this.imageUrl1 = this.web_file_url + res.data[0].file_url
                    this.loading = true;
                    var thsi = this;
                    $.post('/interviewer/ocr_sfz/', {idCardSide: 'front', url: this.imageUrl1}, function (res) {
                        thsi.loading = false;
                        thsi.form.ocr_info_front = res.data;
                        thsi.ocr_info_front = res.data;

                    })
                },
                handleAvatarSuccess2(res, file) {
                    console.log(res.data[0].file_url)
                    this.loading2 = true;
                    var thsi = this;
                    this.imageUrl2 = this.web_file_url + res.data[0].file_url
                    $.post('/interviewer/ocr_sfz/', {idCardSide: 'back', url: this.imageUrl2}, function (res) {
                        thsi.loading2 = false;
                        thsi.form.ocr_info_back = res.data;
                        thsi.ocr_info_back = res.data;
                    })
                },
                beforeAvatarUpload(file) {
                    const isJPG = file.type === 'image/jpeg' || file.type === 'image/png';
                    const isLt2M = file.size / 1024 / 1024 < 2;

                    if (!isJPG) {
                        this.$message.error('上传图片只能是 JPG 或 png 格式!');
                    }
                    if (!isLt2M) {
                        this.$message.error('上传图片大小不能超过 2MB!');
                    }
                    return isJPG && isLt2M;
                }
            }
        })


    </script>
{% endblock %}
