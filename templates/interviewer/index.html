{% extends "base.html" %}
{% block body %}
    <style>
        #wrapper {
            width: 600px;
            margin: 0 auto;
        }
    </style>
    <div id="wrapper">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>申请成为面试官</legend>
        </fieldset>
        <form class="layui-form" action="">
            <div class="layui-form-item">
                <label class="layui-form-label">账号</label>
                <div class="layui-input-block">
                    <input type="text" name="username" lay-verify="username" autocomplete="off"
                           placeholder="请输入登录账号" maxlength="20"
                           class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">密码</label>
                <div class="layui-input-block">
                    <input type="password" name="password1" placeholder="请填写6到12位密码" lay-verify="password1"
                           autocomplete="off" class="layui-input" maxlength="12" minlength="6">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">确认密码</label>
                <div class="layui-input-block">
                    <input type="password" name="password2" placeholder="再次输入密码" lay-verify="password2"
                           autocomplete="off" class="layui-input" maxlength="12" minlength="6">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">姓名</label>
                <div class="layui-input-block">
                    <input type="text" name="name" lay-verify="name" autocomplete="off" placeholder="请输入您的姓名"
                           class="layui-input" maxlength="12">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">性别</label>
                <div class="layui-input-block">
                    <select name="age" lay-filter="age" lay-verify="age">
                        <option value="" selected=""></option>
                        <option value="1">男</option>
                        <option value="2">女</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">手机号</label>
                <div class="layui-input-block">
                    <input type="number" name="phone_number" lay-verify="phone_number" autocomplete="off"
                           placeholder="请输入您的手机号"
                           class="layui-input" maxlength="11">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">验证码</label>
                <div class="layui-input-block">
                    <input type="number" name="code" lay-verify="code" autocomplete="off"
                           placeholder="请获取验证码"
                           class="layui-input" maxlength="6" style="width: 200px;">
                    <a href="javascript:" class="layui-btn" id="send_code" style="float: left;margin-top: 10px;" onclick="send_code()">获取验证码</a>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">邮箱</label>
                <div class="layui-input-block">
                    <input type="email" name="email" lay-verify="email" autocomplete="off" placeholder="请输入您的电子邮箱"
                           class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">身份证</label>
                <div class="layui-input-block">
                    <input type="text" name="number_id" lay-verify="number_id" autocomplete="off" placeholder="请输入身份证号"
                           class="layui-input" maxlength="18">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">毕业院校</label>
                <div class="layui-input-block">
                    <input type="text" name="school" lay-verify="school" autocomplete="off" placeholder="请输入毕业院校"
                           class="layui-input" maxlength="20">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">学历</label>
                <div class="layui-input-block">
                    <select name="school_level" lay-filter="school_level" lay-varify="school_level">
                        <option value="" selected=""></option>
                        <option value="1">大专</option>
                        <option value="2">本科</option>
                        <option value="3">硕士</option>
                        <option value="4">博士</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">专业</label>
                <div class="layui-input-block">
                    <input type="text" name="speciality" lay-verify="speciality" autocomplete="off"
                           placeholder="请输入您的专业"
                           class="layui-input" maxlength="20">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">职业</label>
                <div class="layui-input-block">
                    <input type="text" name="speciality" lay-verify="speciality" autocomplete="off"
                           placeholder="请输入您的职业"
                           class="layui-input" maxlength="20">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">身份证(正面)</label>
                <div class="layui-input-block">
                    <button type="button" name="number_id_img1" class="layui-btn" id="number_id_img1">
                        <i class="layui-icon">&#xe67c;</i>上传图片
                    </button>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">身份证(反面)</label>
                <div class="layui-input-block">
                    <button type="button" name="number_id_img2" class="layui-btn" id="number_id_img2">
                        <i class="layui-icon">&#xe67c;</i>上传图片
                    </button>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label"></label>
                <button type="submit" class="layui-btn" lay-submit="" lay-filter="demo1">注册</button>
            </div>
        </form>
    </div>
{% endblock %}
{% block js %}
    <script>

        var number_id_img1 = "";
        var number_id_img2 = "";

        $(function () {



            layui.use('upload', function () {
            var upload = layui.upload;
            var upload_url = ''
    var upload_key = "";
    $.get('/uploads/upload_key/', function (res) {
        upload_key = res.data.key;
        upload_url = `{{ upload_url }}?upcheck=${upload_key}&up_type=number_id_img`
        console.log(upload_url)
        //执行实例
            upload.render({
                elem: '#number_id_img1' //绑定元素
                , url: upload_url //上传接口
                , size: 10
                , accept: "images"
                , acceptMime: "image/jpg, image/png"
                , done: function (res) {
                    console.log(res)
                    number_id_img1 = res.data[0].file_url
                }
                , error: function () {
                    //请求异常回调
                }
            });

            //执行实例
            upload.render({
                elem: '#number_id_img2' //绑定元素
                , url: upload_url //上传接口
                , size: 10
                 , accept: "images"
                , acceptMime: "image/jpg, image/png"
                , done: function (res) {
                    //上传完毕回调
                    number_id_img2 = res.data[0].file_url
                }
                , error: function () {
                    //请求异常回调
                }
            });
    })



        });

        })
        var exit_count = 60;
        function send_code() {
            $("#send_code").addClass('layui-btn-disabled')
            msg_ok("验证码已发送，30分钟内有效。")
            var inter_exit = window.setInterval(function () {
                exit_count = exit_count - 1;
                if (exit_count < 0) {
                    $("#send_code").removeClass('layui-btn-disabled')
                    $("#send_code").text('获取验证码')
                    window.clearInterval(inter_exit);
                }else{
                    $("#send_code").text(exit_count + 's')
                }
            }, 1000);
        }





        var form = layui.form

        form.on('submit(demo1)', function (data) {
            data.field.number_id_img1 = number_id_img1
            data.field.number_id_img2 = number_id_img2
            $.post(location.href, data.field, function (res) {
                if (res.response === 'ok') {
                    msg_ok(res.message, function () {
                        window.parent.document.getElementById('iframe').src = './pages/zhaopinxinxi/list.html';
                    })

                } else {
                    msg_fail(res.message)
                }
            })
            return false;
        });

        //自定义验证规则
        form.verify({
            username: function (value) {
                if (value.length < 5) {
                    return '登录账号至少5个字符';
                }
            },
            password1: [/^[\S]{6,12}$/, '密码必须6到12位，且不能出现空格'],
            password2: function (value) {
                let pwd2 = $("input[name=password1]").val()
                if (value !== pwd2) {
                    return '两次输入密码不一致';
                }
            },
            name: function (value) {
                if (value.length < 2) {
                    return '姓名至少2个字符';
                }
            },
            age: function (value) {
                if (value === '') {
                    console.log(value)
                    return '请选择性别';
                }
            },
            phone_number: function (value) {
                if (value === '') {
                    return '请输入手机号';
                }
                if (value.length !== 11) {
                    return '请输入正确的手机号';
                }
            },
            email: function (value) {
                if (value === '') {
                    return '请输入邮箱';
                }
            },
            number_id: function (value) {
                if (value.length !== 18) {
                    return '请输入18位身份证号';
                }
            },
            school: function (value) {
                if (value === '') {
                    return '请输入毕业院校';
                }
            },
            school_live: function (value) {
                if (value === '') {
                    return '请选择学历';
                }
            },
            speciality: function (value) {
                if (value === '') {
                    return '请输入专业';
                }
            },

        });



    </script>
{% endblock %}
