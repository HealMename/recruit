{% extends "base.html" %}
{% block body %}
    <style>
        #wrapper {
            width: 600px;
            margin: 0 auto;
        }

        .layui-layer-title {
            display: none;
        }
        .layui-layer-setwin {
            display: none;
        }
    </style>
    <div id="wrapper">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>出题专家注册</legend>
        </fieldset>
        <form class="layui-form" action="">
            <div class="layui-form-item">
                <label class="layui-form-label">昵称</label>
                <div class="layui-input-block">
                    <input type="text" name="username" lay-verify="username" autocomplete="off"
                           placeholder="请输入昵称" maxlength="20"
                           class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">姓名</label>
                <div class="layui-input-block">
                    <input type="text" name="name" lay-verify="name" autocomplete="off" placeholder="请输入您的姓名"
                           class="layui-input" maxlength="12">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">性别</label>
                <div class="layui-input-block">
                    <select name="age" lay-filter="age" lay-verify="age">
                        <option value="" selected=""></option>
                        <option value="1">男</option>
                        <option value="2">女</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">手机号</label>
                <div class="layui-input-block">
                    <input type="number" name="phone_number" lay-verify="phone_number" autocomplete="off"
                           placeholder="请输入您的手机号"
                           class="layui-input" maxlength="11" id="phone">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">验证码</label>
                <div class="layui-input-block">
                    <input type="number" name="code" lay-verify="code" autocomplete="off"
                           placeholder="请输入短信验证码"
                           class="layui-input" maxlength="6" style="width: 40%;display: inline-block;">
                    <button type="button" class="layui-btn " id="getcode"
                            onclick="sendMessage(this, 60)"
                            style="margin-left: 10px;
                       background-color: #00a7d0;
                       color: white;">获取验证码
                    </button>

                    <div id="your-dom-id" class="nc-container" style="display: none;"></div>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">邮箱</label>
                <div class="layui-input-block">
                    <input type="email" name="email" lay-verify="email" autocomplete="off" placeholder="请输入您的电子邮箱"
                           class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">身份证</label>
                <div class="layui-input-block">
                    <input type="text" name="number_id" lay-verify="number_id" autocomplete="off" placeholder="请输入身份证号"
                           class="layui-input" maxlength="18">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">毕业院校</label>
                <div class="layui-input-block">
                    <input type="text" name="school" lay-verify="school" autocomplete="off" placeholder="请输入毕业院校"
                           class="layui-input" maxlength="20">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">学历</label>
                <div class="layui-input-block">
                    <select name="school_level" lay-filter="school_level" lay-varify="school_level">
                        <option value="" selected=""></option>
                        <option value="1">大专</option>
                        <option value="2">本科</option>
                        <option value="3">硕士</option>
                        <option value="4">博士</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">专业</label>
                <div class="layui-input-block">
                    <input type="text" name="speciality" lay-verify="speciality" autocomplete="off"
                           placeholder="请输入您的专业"
                           class="layui-input" maxlength="20">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"></label>
                <button type="submit" class="layui-btn" lay-submit="" lay-filter="demo1">注册</button>
            </div>
        </form>
    </div>
{% endblock %}
{% block js %}
    <script type="text/javascript" charset="utf-8" src="/media/js/nc.js"></script>

    <script>
        $(function () {
            var nc_token = ["CF_APP_1", (new Date()).getTime(), Math.random()].join(':');
            var NC_Opt = {
                renderTo: "#your-dom-id",
                appkey: "CF_APP_1",
                scene: "register",
                token: nc_token,
                customWidth: 300,
                trans: {"key1": "code0"},
                elementID: ["usernameID"],
                is_Opt: 0,
                language: "cn",
                isEnabled: true,
                timeout: 3000,
                times: 5,
                apimap: {}, callback: function (data) {

                    layer.closeAll();
                }
            }
            var nc = new noCaptcha(NC_Opt)
            nc.upLang('cn', {
                _startTEXT: "请按住滑块，拖动到最右边",
                _yesTEXT: "验证通过",
                _error300: "哎呀，出错了，点击<a href=\"javascript:__nc.reset()\">刷新</a>再来一次",
                _errorNetwork: "网络不给力，请<a href=\"javascript:__nc.reset()\">点击刷新</a>",
            })
        })
        var form = layui.form
        var bode_but = true;
        form.on('submit(demo1)', function (data) {

            $.post(location.href, data.field, function (res) {
                if (res.response === 'ok') {
                    msg_ok(res.message, function () {
                        window.parent.document.getElementById('iframe').src = './pages/zhaopinxinxi/list.html';
                    })

                } else {
                    msg_fail(res.message)
                }
            })
            return false;
        });

        //自定义验证规则
        form.verify({
            username: function (value) {
                if (value.length < 2) {
                    return '昵称至少2个字符';
                }
            },
            code: function (value) {
                if (value.length !== 6) {
                    return '请输入6位数的短信验证码';
                }
            },
            name: function (value) {
                if (value.length < 2) {
                    return '姓名至少2个字符';
                }
            },
            age: function (value) {
                if (value === '') {
                    console.log(value)
                    return '请选择性别';
                }
            },
            phone_number: function (value) {
                if (value === '') {
                    return '请输入手机号';
                }
                if (value.length !== 11) {
                    return '请输入正确的手机号';
                }
            },
            email: function (value) {
                if (value === '') {
                    return '请输入邮箱';
                }
            },
            number_id: function (value) {
                if (value.length !== 18) {
                    return '请输入18位身份证号';
                }
            },
            school: function (value) {
                if (value === '') {
                    return '请输入毕业院校';
                }
            },
            school_live: function (value) {
                if (value === '') {
                    return '请选择学历';
                }
            },
            speciality: function (value) {
                if (value === '') {
                    return '请输入专业';
                }
            },

        });
        var buttonDefaultValue = "获取验证码"

        function sendMessage(obj, second) {
            var phone = $("#phone").val()
            if (phone === "" || phone.length !== 11) {
                msg_fail("请输入手机号")
            } else {
                if (bode_but) {
                    layer.open({
                        type: 1,
                        content: $('#your-dom-id'), //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
                        end: function () {
                            countDown(obj, second)
                            $.post('/sms/send/', {phone: phone, code_id: 3}, function (res) {
                                msg_ok("验证码已发送，2分钟内有效。")
                            })
                        }
                    });
                }
            }
        }

        function countDown(obj, second) {
            // 如果秒数还是大于0，则表示倒计时还没结束

            if (second >= 0) {
                // 按钮置为不可点击状态
                bode_but = false
                $("#getcode").css('background-color', 'grey')
                $("#getcode").addClass('layui-btn-disabled')
                // 按钮里的内容呈现倒计时状态
                $(obj).text(String(second) + '秒后重发');
                // 时间减一
                second--;
                // 一秒后重复执行
                setTimeout(function () {
                    countDown(obj, second);
                }, 1000);
                // 否则，按钮重置为初始状态
            } else {
                // 按钮置未可点击状态
                bode_but = true;
                $("#getcode").removeClass('layui-btn-disabled')
                $("#getcode").css('background-color', '#00a7d0')
                // 按钮里的内容恢复初始状态
                $(obj).text(buttonDefaultValue);
            }
        }

    </script>
{% endblock %}
